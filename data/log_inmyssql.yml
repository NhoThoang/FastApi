## M·∫∑c ƒë·ªãnh c·ªßa c√°c lo·∫°i cache trong MySQL

| **Tham s·ªë**                  | **M√¥ t·∫£** | **Gi√° tr·ªã m·∫∑c ƒë·ªãnh** |
|----------------------------------|------------|-----------------|
| `innodb_buffer_pool_size`       | K√≠ch th∆∞·ªõc b·ªô nh·ªõ cache d√†nh cho d·ªØ li·ªáu v√† index c·ªßa InnoDB | 128M |
| `innodb_log_buffer_size`        | K√≠ch th∆∞·ªõc b·ªô nh·ªõ cache d√†nh cho transaction log | 16M |
| `binlog_cache_size`             | K√≠ch th∆∞·ªõc b·ªô nh·ªõ cache d√†nh cho binlog khi replication | 32K |
| `query_cache_size`              | K√≠ch th∆∞·ªõc b·ªô nh·ªõ cache d√†nh cho k·∫øt qu·∫£ truy v·∫•n (MySQL < 8.0) | 1M |
| `table_open_cache`              | S·ªë b·∫£ng t·ªëi ƒëa ƒë∆∞·ª£c m·ªü c√πng l√∫c | 2000 |
| `thread_cache_size`             | S·ªë l∆∞·ª£ng thread ƒë∆∞·ª£c cache ƒë·ªÉ t√°i s·ª≠ d·ª•ng | T·ª± ƒë·ªông |
| `innodb_flush_log_at_trx_commit`| C√°ch ghi log c·ªßa InnoDB | 1 (Flush ngay khi commit) |
| `innodb_page_size`              | K√≠ch th∆∞·ªõc trang d·ªØ li·ªáu trong InnoDB | 16K |
| `max_binlog_cache_size`         | K√≠ch th∆∞·ªõc t·ªëi ƒëa c·ªßa binlog cache | 4G |

### C√°ch thay ƒë·ªïi c√°c tham s·ªë cache

1. **Thay ƒë·ªïi t·∫°m th·ªùi (ch·ªâ √°p d·ª•ng cho session hi·ªán t·∫°i):**
```sql
SET GLOBAL innodb_buffer_pool_size = 8G;
SET GLOBAL innodb_log_buffer_size = 128M;
SET GLOBAL binlog_cache_size = 16M;
```

2. **Thay ƒë·ªïi vƒ©nh vi·ªÖn (sau khi restart MySQL v·∫´n gi·ªØ nguy√™n):**
- S·ª≠a file c·∫•u h√¨nh `/etc/mysql/my.cnf` ho·∫∑c `/etc/my.cnf`:
```ini
[mysqld]
innodb_buffer_pool_size = 8G
innodb_log_buffer_size = 128M
binlog_cache_size = 16M
```
- Restart MySQL ƒë·ªÉ √°p d·ª•ng:
```bash
sudo systemctl restart mysql
```

üìå T·ªîNG H·ª¢P KI·∫æN TH·ª®C MYSQL - T·ªêI ∆ØU HI·ªÜU SU·∫§T & CACHE
1Ô∏è‚É£ Ki·∫øn tr√∫c c·ªßa MySQL & C√°c lo·∫°i Cache
üîπ C·∫•u tr√∫c MySQL & Qu√° tr√¨nh ƒë·ªçc/ghi d·ªØ li·ªáu
Khi INSERT/UPDATE/DELETE d·ªØ li·ªáu:

Ghi v√†o InnoDB Buffer Pool (innodb_buffer_pool_size)
Ghi v√†o InnoDB Log Buffer (innodb_log_buffer_size)
Ghi v√†o Binary Log Cache (binlog_cache_size, n·∫øu d√πng replication)
Sau ƒë√≥ m·ªõi flush xu·ªëng disk khi commit ho·∫∑c cache ƒë·∫ßy.
Khi SELECT d·ªØ li·ªáu:

MySQL ki·ªÉm tra InnoDB Buffer Pool tr∆∞·ªõc.
N·∫øu kh√¥ng c√≥, MySQL ƒë·ªçc t·ª´ disk ‚Üí l∆∞u v√†o Buffer Pool ƒë·ªÉ cache.
2Ô∏è‚É£ C√°c lo·∫°i cache quan tr·ªçng
Lo·∫°i Cache	Ch·ª©c nƒÉng
innodb_buffer_pool_size	Cache d·ªØ li·ªáu & index c·ªßa InnoDB.
innodb_log_buffer_size	L∆∞u transaction log tr∆∞·ªõc khi flush xu·ªëng disk.
binlog_cache_size	L∆∞u binlog c·ªßa transaction tr∆∞·ªõc khi ghi v√†o binlog file (Replication).
query_cache_size	Cache k·∫øt qu·∫£ query ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô SELECT (deprecated t·ª´ MySQL 8.0).
table_open_cache	Cache table ƒë√£ m·ªü ƒë·ªÉ tr√°nh m·ªü l·∫°i t·ª´ disk m·ªói l·∫ßn query.
thread_cache_size	Cache thread k·∫øt n·ªëi ƒë·ªÉ tr√°nh t·∫°o m·ªõi m·ªói l·∫ßn request ƒë·∫øn.
3Ô∏è‚É£ C√°ch ki·ªÉm tra MySQL c√≥ b·ªã qu√° t·∫£i kh√¥ng?
‚úÖ Ki·ªÉm tra log buffer c√≥ b·ªã ƒë·∫ßy kh√¥ng (innodb_log_buffer_size)?
sql
Copy
Edit
SHOW GLOBAL STATUS LIKE 'innodb_log_waits';
‚û°Ô∏è N·∫øu innodb_log_waits > 0 ‚Üí Log Buffer qu√° nh·ªè, c·∫ßn tƒÉng k√≠ch th∆∞·ªõc.

üõ† Gi·∫£i ph√°p:

sql
Copy
Edit
SET GLOBAL innodb_log_buffer_size = 256M;
‚úÖ Ki·ªÉm tra Buffer Pool c√≥ b·ªã ƒë·∫ßy kh√¥ng (innodb_buffer_pool_size)?
sql
Copy
Edit
SHOW GLOBAL STATUS LIKE 'Innodb_buffer_pool_read%';
üìå T√≠nh cache hit rate:

sql
Copy
Edit
SELECT (1 - (Innodb_buffer_pool_reads / Innodb_buffer_pool_read_requests)) * 100 AS cache_hit_rate
FROM (SELECT VARIABLE_VALUE AS Innodb_buffer_pool_reads 
      FROM performance_schema.global_status WHERE VARIABLE_NAME = 'Innodb_buffer_pool_reads') AS A,
     (SELECT VARIABLE_VALUE AS Innodb_buffer_pool_read_requests
      FROM performance_schema.global_status WHERE VARIABLE_NAME = 'Innodb_buffer_pool_read_requests') AS B;
‚û°Ô∏è N·∫øu cache hit < 90%, MySQL ƒë·ªçc t·ª´ disk qu√° nhi·ªÅu ‚Üí C·∫ßn tƒÉng Buffer Pool.

üõ† Gi·∫£i ph√°p:

sql
Copy
Edit
SET GLOBAL innodb_buffer_pool_size = 16G;
‚úÖ Ki·ªÉm tra binlog cache c√≥ b·ªã ƒë·∫ßy kh√¥ng (binlog_cache_size)?
sql
Copy
Edit
SHOW GLOBAL STATUS LIKE 'Binlog_cache_disk_use';
‚û°Ô∏è N·∫øu Binlog_cache_disk_use > 0 ‚Üí MySQL d√πng file t·∫°m tr√™n disk thay v√¨ RAM.

üõ† Gi·∫£i ph√°p:

sql
Copy
Edit
SET GLOBAL binlog_cache_size = 32M;
4Ô∏è‚É£ Khi n√†o MySQL flush xu·ªëng disk?
Log Buffer (innodb_log_buffer_size) ƒë∆∞·ª£c flush xu·ªëng disk khi:

Transaction commit.
Buffer ƒë·∫ßy.
Th·ªùi gian t·ª± ƒë·ªông flush (1 gi√¢y/l·∫ßn).
Buffer Pool (innodb_buffer_pool_size) ƒë∆∞·ª£c flush khi:

M√°y ch·ªß c·∫ßn RAM cho d·ªØ li·ªáu m·ªõi.
MySQL t·ª± ƒë·ªông background flush.
Server shutdown.
5Ô∏è‚É£ T·ªëi ∆∞u h·ªá th·ªëng khi c√≥ nhi·ªÅu transaction
‚û°Ô∏è Khi c√≥ nhi·ªÅu transaction c√πng l√∫c, c·∫ßn tƒÉng c√°c gi√° tr·ªã:
üîπ TƒÉng innodb_log_buffer_size ƒë·ªÉ tr√°nh flush xu·ªëng disk qu√° s·ªõm.
üîπ TƒÉng innodb_buffer_pool_size ƒë·ªÉ gi·ªØ nhi·ªÅu d·ªØ li·ªáu h∆°n trong RAM.
üîπ TƒÉng binlog_cache_size ƒë·ªÉ tr√°nh ghi binlog xu·ªëng disk.

üî• T√≥m t·∫Øt c√°ch t·ªëi ∆∞u MySQL
‚úÖ TƒÉng cache h·ª£p l√Ω (innodb_buffer_pool_size, innodb_log_buffer_size, binlog_cache_size).
‚úÖ Ki·ªÉm tra cache hit rate ƒë·ªÉ ƒë·∫£m b·∫£o MySQL ƒë·ªçc t·ª´ RAM thay v√¨ disk.
‚úÖ TƒÉng log buffer n·∫øu c√≥ nhi·ªÅu transaction l·ªõn (innodb_log_buffer_size).
‚úÖ Gi·∫£m ghi xu·ªëng disk b·∫±ng c√°ch t·ªëi ∆∞u rollback & commit h·ª£p l√Ω.

üìå N·∫øu h·ªá th·ªëng ch·∫≠m, ki·ªÉm tra b·∫±ng c√°c l·ªánh:

sql
Copy
Edit
SHOW GLOBAL STATUS LIKE 'Innodb_buffer_pool_reads';
SHOW GLOBAL STATUS LIKE 'Innodb_log_waits';
SHOW GLOBAL STATUS LIKE 'Binlog_cache_disk_use';
SHOW GLOBAL STATUS LIKE 'innodb_log_fsyncs';
üöÄ T·ªëi ∆∞u ƒë√∫ng c√°ch s·∫Ω gi√∫p MySQL ch·∫°y nhanh h∆°n & ·ªïn ƒë·ªãnh h∆°n!


D·ª±a v√†o Threads_created v√† Connections

Ch·∫°y l·ªánh sau ƒë·ªÉ xem t·ªïng s·ªë lu·ªìng ƒë√£ t·∫°o v√† s·ªë k·∫øt n·ªëi:
sql
Copy
Edit
SHOW GLOBAL STATUS LIKE 'Threads_created';
SHOW GLOBAL STATUS LIKE 'Connections';
N·∫øu Threads_created qu√° cao so v·ªõi Connections, c√≥ nghƒ©a l√† MySQL ƒëang ph·∫£i t·∫°o qu√° nhi·ªÅu thread m·ªõi, c·∫ßn tƒÉng thread_cache_size.
D·ª±a v√†o hi·ªáu su·∫•t th·ª±c t·∫ø

N·∫øu c√≥ nhi·ªÅu k·∫øt n·ªëi ƒë·ªìng th·ªùi (>100 connections) v√† Threads_created v·∫´n tƒÉng nhanh, h√£y n√¢ng thread_cache_size.

Server nh·ªè (<50 connections): thread_cache_size = 8
Server v·ª´a (50-200 connections): thread_cache_size = 16
Server l·ªõn (>200 connections): thread_cache_size = 32 ho·∫∑c cao h∆°n

SHOW VARIABLES LIKE 'binlog_cache_size';
üîπ Gi√° tr·ªã ƒë·ªÅ xu·∫•t:

Lo·∫°i h·ªá th·ªëng	Gi√° tr·ªã h·ª£p l√Ω
H·ªá th·ªëng nh·ªè (<100 transactions/gi√¢y)	1MB - 4MB
H·ªá th·ªëng trung b√¨nh (100 - 1000 transactions/gi√¢y)	8MB - 32MB
H·ªá th·ªëng l·ªõn (>1000 transactions/gi√¢y)	64MB - 128MB

C√°ch ki·ªÉm tra gi√° tr·ªã hi·ªán t·∫°i:

sql
Copy
Edit
SHOW VARIABLES LIKE 'innodb_log_buffer_size';
üîπ Gi√° tr·ªã ƒë·ªÅ xu·∫•t:

RAM	Gi√° tr·ªã h·ª£p l√Ω
< 4GB	16MB
4GB - 16GB	64MB - 128MB
> 16GB	256MB ho·∫∑c h∆°n